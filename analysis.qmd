---
title: Analysis
description: Here we provide a detailed analysis using more sophisticated statistics techniques.
toc: true
draft: false
---

![](images/MMRpics.jpeg)
# Analysis
```{r load in the data, echo=FALSE}
suppressPackageStartupMessages(library(tidyverse))
load(here::here("dataset/mmr.RData"))
```

```{r figure 1, echo=FALSE}
mmr_data_clean |> 
  group_by(year_id, race_group) |>
  summarize(mean = mean(val)) |>
  ggplot(aes(x = year_id, y = mean)) +
  geom_line(aes(color = race_group)) + 
  labs(
    title = "Maternal Mortality by Race over Time", 
    y = "Mean Maternal Mortality Ratio",
    x = "Year", 
    color = "Racial Groups"
  )
```

Figure 1: The line graph presented displays the trends of mean MMR across different racial and ethnic groups over a span of approximately two decades, starting from the year 2000. Each colored line on the graph represents a different racial or ethnic category, plotting the mean of 'val' for that group against the timeline of 'year_id'. Several key trends and patterns can be discerned from the graph: - The 'Non-Hispanic Black' group exhibits a notable upward trajectory, suggesting a consistent increase in the mean of 'val' over the years. Starting from a position close to other groups in the year 2000, there is a significant rise around the year 2010, and by 2020, this group has the highest mean value among all groups shown. - 'All racial and ethnic groups' combined show a gradual increase, hinting at an overall rising trend in the mean of 'val' across the population. - The 'Non-Hispanic Asian, Native Hawaiian, or Other Pacific Islander' group shows an increase, albeit with some fluctuations and a less steep incline compared to the 'Non-Hispanic Black' and 'Non-Hispanic White' groups.

```{r figure 2, echo=FALSE}
mmr_data_clean |>
  group_by(year_id, location_name) |>
  filter(str_detect(location_name, "Census")) |> 
  summarize(mean = mean(val)) |>
  ggplot(aes(x = year_id, y = mean)) +
  geom_line(aes(color = location_name)) + 
    labs(
    title = "Maternal Mortality by Census Region over Time",
    y = "Mean Maternal Mortality Ratio",
    x = "Year",
    color = "Census Region"
  )
```

Figure 2: The line graph displayed appears to represent the trends in the mean value of MMR over time across four different U.S. Census regions: Midwest, Northeast, South, and West, from the year 2000 to just before 2020. All regions show an initial increase in the mean value from 2000, with varying rates and fluctuations. Around 2005 to 2008, the Northeast region displays a sharper increase, while the Midwest shows a more gradual rise. Post-2010, all regions experience a significant increase in mean values, with the West and South regions peaking around 2015. The Northeast region exhibits a pronounced peak shortly after 2015, followed by a decline, indicating a possible reversal of the trend or a response to an event or policy change. The trends suggest regional variations in the variable measured, with each region experiencing unique patterns of change over the two decades.

```{r figure 3, echo=FALSE}
mmr_data_clean |>
  group_by(year_id, location_name, race_group) |>
  filter(str_detect(location_name, "Census")) |> 
  summarize(mean = mean(val))|>
  ggplot(aes(x = year_id, y = mean)) +
  geom_line(aes(color = location_name)) + 
  facet_wrap(~race_group) + 
  labs(
    title = "Maternal Mortality by Census Region over Time, Faceted by Race",
    x = "Mean Maternal Mortality Ratio",
    y = "Year",
    color = "Census Region"
  )

```

Figure 3: The five graphs depict the trajectory of maternal mortality rates over a 20-year period, differentiated by racial categories and geographic regions in the United States.  These categories include Hispanic and any race, Non-Hispanic American Indian and Alaska Native, Non-Hispanic Asian and Native Hawaiian or Other Pacific Islander, Non-Hispanic Black, and Non-Hispanic White.  While there is an overarching increase in mortality rates across these racial demographics, the patterns of increase vary notably between them.

For the categories of Hispanic and any race, Non-Hispanic Asian and Native Hawaiian or Other Pacific Islander, and Non-Hispanic White, the mortality rates appear to be relatively stable, with slight fluctuations over the two decades.  The lines on the graph for these groups are relatively flat, suggesting less volatility in their yearly rates and possibly better outcomes when compared to the other categories.

Contrastingly, the Non-Hispanic Black category exhibits a pronounced upward trend in the Northeast and South regions, indicating a concerning rise in maternal mortality rates that surpasses the other racial groups in these areas.  This suggests that Non-Hispanic Black women in these regions are disproportionately affected by factors contributing to maternal mortality.

The Non-Hispanic American Indian and Alaska Native category demonstrates a significant increase in maternal mortality rates, particularly in the Midwest and West regions.  The sharp rise could be indicative of systemic health disparities or regional deficiencies in healthcare access or quality that particularly impact this demographic.

The observed regional differences, such as higher rates in the South and variations in the Midwest and West, might be influenced by a multitude of factors including healthcare infrastructure, socioeconomic status, accessibility of prenatal and postnatal care, and population density.  Regions with higher population densities might face different healthcare challenges than less densely populated areas, potentially affecting the availability and quality of care.


```{r figure 3.5, echo = FALSE}
mmr_diff <- mmr_data_clean |> 
  group_by(location_name, year_id) |> 
  summarize(mean_mmr = mean(val)) |> 
  filter(year_id %in% c(1999, 2019)) |> 
  pivot_wider(names_from = year_id, values_from = mean_mmr) |> 
  rename(y1999 = '1999') |> 
  rename(y2019 = '2019') |> 
  mutate(difference = y2019-y1999) |> 
  arrange(difference)

mmr_diff$region_id = mmr_diff$location_name

northeast <- c("Connecticut", "Massachusetts", "Maine", "Maine", 
               "New Hampshire", "Rhode Island", "Vermont", "New Jersey", 
               "New York", "Pennsylvania")
midwest <- c("Indiana", "Illinois", "Michigan", "Ohio", "Wisconsin", "Iowa", 
             "Kansas", "Minnesota", "Missouri", "Nebraska", "North Dakota", 
             "South Dakota")
south <- c("Delaware", "District of Columbia", "Florida", "Georgia", "Maryland", 
          "North Carolina", "South Carolina", "Virginia", "West Virginia", 
          "Alabama", "Kentucky", "Mississippi", "Tennessee", "Arkansas", 
          "Louisiana", "Oklahoma", "Texas")
west <- c("Arizona", "Colorado", "Idaho", "New Mexico", "Montana", "Utah", 
          "Nevada", "Wyoming", "Alaska", "California", "Hawaii", "Oregon", 
          "Washington")

for(i in 1:56){
  if (mmr_diff[i, 1] %in% northeast){
    mmr_diff[i, 5] = "Northeast Census Region"
  } else if (mmr_diff[i, 1] %in% midwest){
    mmr_diff[i, 5] = "Midwest Census Region"
  } else if (mmr_diff[i, 1] %in% south){
    mmr_diff[i, 5] = "South Census Region"
  } else if (mmr_diff[i, 1] %in% west){
    mmr_diff[i, 5] = "West Census Region"
  }
}

mmr_diff |> 
  ggplot(aes(x = reorder(location_name, difference), y = difference)) +
  geom_point(aes(color = region_id)) + 
  labs( 
    title = "Change in Maternal Mortality 1999-2019",
    x = "State",
    y = "Difference",
    color = "Region") + 
  theme(axis.text.x = element_text(angle=70, hjust=1))
```

```{r figure 3.75, echo = FALSE}

load(here::here("dataset/phc_mmr.RData"))


df <- read_csv(here::here("dataset/phc_mmr_combined.csv"), col_types = cols(
  location_name= col_character(),
  year_id = col_double(),
  spending = col_double(),
  mean_val = col_double())) 

df |>
  group_by(year_id, location_name) |>
  filter(str_detect(location_name, "Census")) |>
  summarize(mean = mean(spending)) |>
  ggplot(aes(x = year_id, y = mean)) +
  geom_line(aes(color = location_name)) +
    labs(
    title = "Spending by Census Region over Time",
    y = "Mean Spending",
    x = "Year",
    color = "Census Region"
  )


```

``` {r figure 4, echo=FALSE}
suppressPackageStartupMessages(library(tidyverse))
load(here::here("dataset/phc_mmr.RData"))

combined_data |> 
  ggplot(aes(x = spending, y = mean_val)) + 
  geom_point(aes(alpha = 0.01))+  
  theme(legend.position = "none") + 
  labs(
    title = "Maternal Mortality v.s. Healthcare Spending",
    x = "Spending",
    y = "MMR"
  )
```

Figure 4: MMR vs Spending 
pos correlation???
An initial plot of personal healthcare spending versus maternal mortality ratio shows a roughly positive correlation between the two variables which contradicts what we expected the relationship to be coming into this analysis. We would have expected a negative correlation, implying that as states spend more on healthcare overall, maternal mortality rates would be lower.


```{r figure 5, echo=FALSE}
combined_data |> 
  ggplot(aes(x = spending, y = mean_val)) + 
  geom_point(aes(alpha = 0.01)) + 
  facet_wrap(~year_id) +  
  theme(legend.position = "none") + 
  labs(
    title = "Maternal Mortality v.s. Healthcare Spending by Year",
    x = "Spending",
    y = "MMR"
  )
```
Figure 5: Faceted MMR vs Spending
We then faceted the initial graph by year to show the trend over time. This reveals a few things. Firstly, when faceted by year the relationship no longer appears to have a positive correlation. The trend is hard to see without a regression however it does appear to be negatively correlated now. Additionally, the points for each state are spreading out. In the first few years, all the points are clumped together with lower values. However, as the years go by the points not only overall increase in value but move farther apart. This prompted us to do a standard deviation analysis to quantify this observed trend.

```{r standard deviation calculation, echo=FALSE}
# 
# ## cut!
# std_dev_mmr <- combined_data |> 
#   group_by(year_id) |> 
#   summarise(sd_mmr = sd(mean_val))
# std_dev_phc <- combined_data |> 
#   group_by(year_id) |> 
#   summarise(sd_phc = sd(spending))
# std_combined <- merge(std_dev_mmr, std_dev_phc, by = c("year_id"), all = TRUE)
```

```{r figure 6, echo=FALSE}
# ### cut!
# 
# std_combined |> 
#   ggplot(aes(x=year_id, y=sd_mmr)) + 
#   geom_point(aes(alpha = 0.1)) +
#   theme(axis.text.x = element_text(angle = -25, hjust = 1), legend.position = "none") + 
#   labs(
#     title = "Standard Deviation of Maternal Mortality Ratios Over Time",
#     x = "Year",
#     y = "MMR")

```

```{r figure 7, echo=FALSE}
# ## cut!
# std_combined |> 
#   ggplot(aes(x=year_id, y=sd_phc)) + 
#   geom_point(aes(alpha = 0.1)) +
#   theme(axis.text.x = element_text(angle = -25, hjust = 1), legend.position = "none") + 
#     labs(
#     title = "Standard Deviation of Healthcare Spending Over Time",
#     x = "Year",
#     y = "Spending")
```

Figures 6 and 7:
Both graphs show an increasing trend over time, supporting an initial visual analysis that the data is getting more spread out. The graph of healthcare spending deviation is particularly linear which drew our interest however we are unsure of how this would implicate our analysis. 


```{r figure 8, echo=FALSE}
library(ggplot2)
library(readr)
library(dplyr)

data <- read_csv("dataset/Cleaned_Pregnancy_Data.csv")

average_data <- data %>%
  group_by(year, region) %>%
  summarize(MeanAge = mean(average_age_of_pregnancy, na.rm = TRUE), .groups = 'drop')

ggplot(average_data, aes(x = year, y = MeanAge, color = region, group = region)) +
  geom_line() +
  labs(title = "Trend of Mean Age of Pregnancy Over Time by Region",
       x = "year",
       y = "Mean Age of Pregnancy") +
  theme_minimal() +
  scale_color_brewer(palette = "Set1")
```

Figure 8:
This graph displays the trend of the mean age of pregnancy over time, categorized by region. From the graph, we can figure out that: In every region, the mean age of pregnancy has increased over time. This suggests that, on average, women are having children at an older age than they did in the past. The 'West' region shows the highest mean age of pregnancy over the entire timeline, starting at around 24 years in the 1970s and rising to just below 30 by the 2010s. The 'Midwest' and 'South' regions appear to have a similar starting point in the 1970s but diverge slightly over time. The 'South' follows closely with the 'West', but it still has a lower mean age of pregnancy by the 2010s. The 'Northeast' region begins with the lowest mean age of pregnancy but increases at a rate similar to the 'Midwest', surpassing it around the mid-2000s.

```{r figure 9, echo=FALSE}
library(ggplot2)
library(readr)

data <- read_csv("dataset/phc_mmr_with_age.csv")

data$spending <- as.numeric(data$spending)
data$AverageAge <- as.numeric(data$AverageAge)

ggplot(data, aes(x = spending, y = AverageAge, color = Region)) +
  geom_point(aes(size = 3), alpha = 0.6) +  
  geom_smooth(method = "lm", se = FALSE, aes(group = Region)) +  
  scale_size_identity() +  
  labs(title = "Bubble Chart with Fitted Lines by Region",
       x = "Healthcare Spending",
       y = "Average Age of Pregnancy",
       size = "Region") +
  theme_minimal() +
  facet_wrap(~Region)
  guides(color = guide_legend(title = "Region"))
```
Figure 9: This scatter plot compares healthcare spending with the average
age of pregnancy by region. Key observations include: There appears to
be a positive correlation between healthcare spending and the average
age of pregnancy in all regions. This implies that as healthcare
spending increases, the average age of pregnancy tends to be higher. The
data for the 'West' region, shown in purple, indicates a particularly
strong positive correlation, suggesting that increased healthcare
spending in this region might be closely associated with women having
children at older ages. Overall, the graph suggests a trend where
regions with higher healthcare spending are associated with older
average ages of pregnancy, which could reflect a variety of factors such
as access to reproductive health services, birth control, career
opportunities, or other socioeconomic factors that allow or encourage
women to delay pregnancy.


```{r figure 10, echo=FALSE}
ggplot(data, aes(x = AverageAge, y = mean_val, size = spending)) +
  geom_point(alpha = 0.6) +
  facet_wrap(~Region) +
  labs(title = "Bubble Chart of Average Age, MMR, and Healthcare Spending",
       x = "Average Age of Pregnancy",
       y = "MMR (per 100,000 live births)",
       size = "Healthcare Spending") +
  theme_minimal()
```
Figure 10: This bubble chart illustrates the relationship between the
average age of pregnancy, maternal mortality ratio (MMR per 100,000 live
births), and healthcare spending by region. The x-axis represents the
average age of pregnancy, the y-axis represents the MMR, and the bubble
size corresponds to healthcare spending, with larger bubbles indicating
higher spending.

Observations from the chart: - There appears to be a concentration of
data points between the ages of 24 and 30, with varying MMR across the
regions. - The Midwest, Northeast, and South regions have clusters with
a wide range of MMR values but are generally centered around the same
average age of pregnancy. - The West region shows a cluster with a lower
MMR in comparison to other regions for a similar average age of
pregnancy.

The chart suggests complexity in the relationship between healthcare
spending, the average age of pregnancy, and MMR, and it would likely
require a deeper analysis to understand the underlying factors and
dynamics.





# Thesis???
## also needs regressions









This comes from the file `analysis.qmd`.

We describe here our detailed data analysis. This page will provide an overview of what questions you addressed, illustrations of relevant aspects of the data with tables and figures, and a statistical model that attempts to answer part of the question. You'll also reflect on next steps and further analysis.

The audience for this page is someone like your class mates, so you can expect that they have some level of statistical and quantitative sophistication and understand ideas like linear and logistic regression, coefficients, confidence intervals, overfitting, etc. 

While the exact number of figures and tables will vary and depend on your analysis, you should target around 5 to 6. An overly long analysis could lead to losing points.
If you want you can link back to your blog posts or create separate pages with more details.

The style of this paper should aim to be that of an academic paper. 
I don't expect this to be of publication quality but you should keep that aim in mind.
Avoid using "we" too frequently, for example "We also found that ...". Describe your methodology and your findings but don't describe your whole process.

### Example of loading data

The code below shows an example of loading the loan refusal data set (which you should delete at some point).

```{r, echo=FALSE}
library(tidyverse)
print(getwd())
data <- read_csv(here::here("dataset/loan_refusal_clean.csv"))
load(here::here("dataset/loan_refusal.RData"))
print(ls())
```

## Note on Attribution

In general, you should try to provide links to relevant resources, especially those that helped you. You don't have to link to every StackOverflow post you used but if there are explainers on aspects of the data or specific models that you found helpful, try to link to those. Also, try to link to other sources that might support (or refute) your analysis. These can just be regular hyperlinks. You don't need a formal citation.

If you are directly quoting from a source, please make that clear. You can show quotes using `>` like this

```         
> To be or not to be.
```

> To be or not to be.

------------------------------------------------------------------------

## Rubric: On this page

You will

-   Introduce what motivates your Data Analysis (DA)
    -   Which variables and relationships are you most interested in?
    -   What questions are you interested in answering?
    -   Provide context for the rest of the page. This will include figures/tables that illustrate aspects of the data of your question.
-   Modeling and Inference
    -   The page will include some kind of formal statistical model. This could be a linear regression, logistic regression, or another modeling framework.
    -   Explain the ideas and techniques you used to choose the predictors for your model. (Think about including interaction terms and other transformations of your variables.)
    -   Describe the results of your modelling and make sure to give a sense of the uncertainty in your estimates and conclusions.
-   Explain the flaws and limitations of your analysis
    -   Are there some assumptions that you needed to make that might not hold? Is there other data that would help to answer your questions?
-   Clarity Figures
    -   Are your figures/tables/results easy to read, informative, without problems like overplotting, hard-to-read labels, etc?
    -   Each figure should provide a key insight. Too many figures or other data summaries can detract from this. (While not a hard limit, around 5 total figures is probably a good target.)
    -   Default `lm` output and plots are typically not acceptable.
-   Clarity of Explanations
    -   How well do you explain each figure/result?
    -   Do you provide interpretations that suggest further analysis or explanations for observed phenomenon?
-   Organization and cleanliness.
    -   Make sure to remove excessive warnings, hide most or all code, organize with sections or multiple pages, use bullets, etc.
    -   This page should be self-contained, i.e. provide a description of the relevant data.


Notes from presentation:
cut: mmr by region not facetted since we also have facetted, STD graphs


Model Findings:
```{r, echo=FALSE}
# Load necessary packages
library(readr)
library(broom)
library(knitr)

# Read in the data
data <- read_csv("dataset/phc_mmr_combined.csv", show_col_types = FALSE)

# Convert mean_val to values per 1,000,000
data$mean_val <- data$mean_val / 100

# Fit the regression model
model <- lm(mean_val ~ spending, data = data)

# Generate the coefficients table using broom
coefficients_table <- tidy(model)

# Format the coefficients table using knitr::kable
kable(
  coefficients_table,
  col.names = c("Term", "Estimate", "Standard Error", "t-Statistic", "p-Value"),
  caption = "Regression Coefficients Table"
)

```
Statistical Performance:
```{r, echo=FALSE}
# Load necessary packages
library(readr)
library(broom)
library(knitr)

# Read in the data
data <- read_csv("dataset/phc_mmr_combined.csv", show_col_types = FALSE)

# Convert mean_val to values per 100000
data$mean_val <- data$mean_val / 100

# Fit the regression model
model <- lm(mean_val ~ spending, data = data)

# Generate the coefficients table using broom
coefficients_table <- tidy(model)

# Generate the model fit statistics table
model_summary <- summary(model)
fit_statistics <- data.frame(
  Metric = c("R-squared", "Adjusted R-squared", "Sigma", "F-statistic", "p-value", "Degrees of Freedom"),
  Value = c(
    model_summary$r.squared,
    model_summary$adj.r.squared,
    model_summary$sigma,
    model_summary$fstatistic[1],
    pf(model_summary$fstatistic[1], model_summary$fstatistic[2], model_summary$fstatistic[3], lower.tail = FALSE),
    model_summary$fstatistic[2]
  )
)

# Output the model fit statistics table
kable(
  fit_statistics,
  col.names = c("Metric", "Value"),
  caption = "Model Fit Statistics Table"
)

```

linear regression MMR-AGE
```{r}
# Load necessary packages
library(broom)
library(knitr)

data <- read_csv("dataset/new_phc_mmr_combine.csv", show_col_types = FALSE)
data$AverageAge <- as.integer(data$AverageAge)
# Fit the simple linear regression model with AverageAge as the predictor
model <- lm(mean_val ~ AverageAge, data = data)

# Tidy the regression coefficients
coefficients_table <- tidy(model)

# Gather model statistics
model_summary <- summary(model)
fit_statistics <- data.frame(
  Metric = c("R-squared", "Adjusted R-squared", "Sigma", "F-statistic", "p-value", "Degrees of Freedom"),
  Value = c(
    model_summary$r.squared,
    model_summary$adj.r.squared,
    model_summary$sigma,
    model_summary$fstatistic[1],
    pf(model_summary$fstatistic[1], model_summary$fstatistic[2], model_summary$fstatistic[3], lower.tail = FALSE),
    model_summary$fstatistic[2]
  )
)

# Output the coefficients table
kable(
  coefficients_table,
  col.names = c("Term", "Estimate", "Standard Error", "t-Statistic", "p-Value"),
  caption = "Regression Coefficients Table"
)

# Output the model fit statistics table
kable(
  fit_statistics,
  col.names = c("Metric", "Value"),
  caption = "Model Fit Statistics Table"
)


```



```{r}
# Load necessary library
library(dplyr)

# Read the dataset
# Replace 'dataset/new_phc_mmr_combine.csv' with the path to your actual CSV file
data <- read.csv('dataset/new_phc_mmr_combine.csv')

# Filter out rows where AverageAge is "N/A"
data <- data %>% filter(AverageAge != "N/A")

# Ensure that Region and race_group are factors
data$Region <- as.factor(data$Region)
data$race_group <- as.factor(data$race_group)

# Convert categorical variables to dummy variables
# This will create new columns with binary values (1 or 0)
region_dummies <- model.matrix(~Region - 1, data = data)
race_group_dummies <- model.matrix(~race_group - 1, data = data)

# Combine mean_val with the dummy variables
# Keep only numeric variables
data_clean <- cbind(data$mean_val, region_dummies, race_group_dummies)

# Compute the correlation matrix
correlation_matrix <- cor(data_clean, use = "complete.obs")

# Display the correlation matrix
print(correlation_matrix)

```


